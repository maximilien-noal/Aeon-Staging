<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Aeon.Emulator.Launcher.Debugger"
                    xmlns:dbg="clr-namespace:Aeon.Emulator.DebugSupport;assembly=Aeon.Emulator">
    
    <Style Selector="CheckBox.miniExpanderButton" x:Key="miniExpanderButtonStyle">
        <Setter Property="Template">
            <Setter.Value>
    <ControlTemplate TargetType="CheckBox">
        <Border Name="border" Width="12" Height="12" BorderThickness="1" BorderBrush="Black" Background="Transparent" Margin="2" CornerRadius="2">
            <Grid>
                <Rectangle Name="horizontalLine" StrokeThickness="0" Fill="Black" Width="8" Height="2" VerticalAlignment="Center" />
                <!-- Vertical line shown when not checked - using binding instead of trigger -->
                <Rectangle Name="verticalLine" StrokeThickness="0" Fill="Black" Width="2" Height="8" HorizontalAlignment="Center" 
                           IsVisible="{Binding !IsChecked, RelativeSource={RelativeSource TemplatedParent}}" />
            </Grid>
        </Border>
        <!-- ControlTemplate.Triggers not supported in Avalonia - using Styles with pseudo-classes -->
    </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    
    <DataTemplate x:Key="instructionTemplate" DataType="{x:Type dbg:Instruction}">
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="{Binding CS, StringFormat={}{0:X4}:}" />
            <TextBlock Text="{Binding EIP, StringFormat={}{0:X8}}" Margin="0,0,20,0" />
            <TextBlock Text="{Binding Opcode.Name}" />
            <TextBlock Text=" " />
            <local:OperandDisplay Operand="{Binding Operands.Operand1}" Instruction="{Binding}" />
            <!-- DataTriggers not supported in Avalonia - commas shown conditionally in OperandDisplay control -->
            <TextBlock Text=", " IsVisible="{Binding Operands.Operand2, Converter={x:Static ObjectConverters.IsNotNull}}" />
            <local:OperandDisplay Operand="{Binding Operands.Operand2}" Instruction="{Binding}" />
            <TextBlock Text=", " IsVisible="{Binding Operands.Operand3, Converter={x:Static ObjectConverters.IsNotNull}}" />
            <local:OperandDisplay Operand="{Binding Operands.Operand3}" Instruction="{Binding}" />
        </StackPanel>
    </DataTemplate>

    <DataTemplate x:Key="loggedInstructionTemplate" DataType="{x:Type dbg:LoggedInstruction}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <CheckBox Name="expandCheckBox" Classes="miniExpanderButton" />
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <TextBlock Text="{Binding CS, StringFormat={}{0:X4}:}" />
                <TextBlock Text="{Binding EIP, StringFormat={}{0:X8}}" Margin="0,0,20,0" />
                <TextBlock Text="{Binding Opcode.Name}" />
                <TextBlock Text=" " />
                <local:OperandDisplay Operand="{Binding Operands.Operand1}" Instruction="{Binding}" />
                <!-- DataTriggers not supported in Avalonia - commas shown conditionally -->
                <TextBlock Text=", " IsVisible="{Binding Operands.Operand2, Converter={x:Static ObjectConverters.IsNotNull}}" />
                <local:OperandDisplay Operand="{Binding Operands.Operand2}" Instruction="{Binding}" />
                <TextBlock Text=", " IsVisible="{Binding Operands.Operand3, Converter={x:Static ObjectConverters.IsNotNull}}" />
                <local:OperandDisplay Operand="{Binding Operands.Operand3}" Instruction="{Binding}" />
            </StackPanel>
            <!-- Trigger for checkbox not supported - binding IsVisible to IsChecked -->
            <local:RegisterViewer x:Name="registerViewer" Grid.Column="1" Grid.Row="1" RegisterSource="{Binding}" 
                                  IsVisible="{Binding #expandCheckBox.IsChecked}" />
        </Grid>
    </DataTemplate>
    
    <local:InstructionTemplateSelector x:Key="instructionTemplateSelector" />
</ResourceDictionary>